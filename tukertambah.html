<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Form Penjualan MT</title>
    <link href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" rel="stylesheet">
    <style>
        body {
            font-family: Arial, sans-serif;
        }

        .form-penjualan {
            margin-bottom: 20px;
        }

        .hasil-item {
            margin: 10px 0;
        }
    </style>
</head>
<body>
    <nav class="navbar navbar-expand-lg navbar-dark bg-dark">
        <a class="navbar-brand" href="#">Penjualan MT</a>
        <div class="collapse navbar-collapse">
            <ul class="navbar-nav mr-auto">
                <li class="nav-item active">
                    <a class="nav-link" href="#">Home</a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" href="jualmd.html">Penjualan MD</a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" href="jualmt.html">Penjualan MT</a>
                </li>
            </ul>
        </div>
    </nav>
    <div class="container mt-4">
        <h1>Form Penjualan</h1>
        <div id="forms-container">
            <div class="form-penjualan">
                <div class="form-group">
                    <label for="kode">Kode Barang:</label>
                    <!-- Kode Barang Dropdown -->
<select class="form-control kode">
    <option value="">Pilih Barang</option>
    <option value="455000">35.5 B 6K</option>
    <option value="455000">36 XB 6K</option>
    <option value="555000">44 Kuning 8K</option>
    <option value="580000">46 Putih 8K</option>
    <option value="605000">48 Kuning 8K</option>
    <option value="620000">49 Putih 8K</option>
    <option value="933000">75 16K</option>
    <option value="942000">76 XB 16K</option>
    <option value="1029000">83 17K</option>
    <option value="1042000">84 XB 17K</option>
    <option value="978000">78-79 BG&Amero 16K</option>
    <option value="1104000">89 LPM&Amero 17K</option>
    <option value="1116000">90 SDW</option>
</select>
                </div>
                <div class="form-group">
                    <label for="harga">Harga:</label>
                    <input type="text" class="form-control harga" readonly>
                </div>
                <div class="form-group">
                    <label for="berat">Berat (gr):</label>
                    <input type="number" class="form-control berat">
                </div>
                <button class="btn btn-dark" onclick="hitungHarga(this)">Hitung</button>
            </div>
        </div>
        <button id="tambah-barang" class="btn btn-primary mt-3" onclick="tambahForm()">Tambah Barang</button>
        <button id="clear" class="btn btn-danger mt-3" onclick="clearAll()">Clear</button>
        <h2 class="mt-4">Hasil Penjualan</h2>
        <div id="hasil"></div>
        <h2>Total Harga: <span id="total-harga">0</span></h2>

        <div class="form-beli mt-4">
            <h2>Form Beli</h2>
            <div class="form-group">
                <label for="harga-nota">Harga Nota:</label>
                <input type="number" class="form-control" id="harga-nota">
            </div>
            <div class="form-group">
                <label for="harga-pokok">Harga Pokok:</label>
                <input type="number" class="form-control" id="harga-pokok">
            </div>
            <div class="form-group">
                <label for="potongan">Potongan:</label>
                <input type="number" class="form-control" id="potongan">
            </div>
            <div class="form-group">
                <label for="berat-beli">Berat (gr):</label>
                <input type="number" class="form-control" id="berat-beli">
            </div>
            <button class="btn btn-dark" onclick="hitungTotalBeli()">Hitung Total Beli</button>
            <h2 class="mt-3">Total Beli: <span id="total-beli">0</span></h2>
        </div>
    </div>

    <script src="https://code.jquery.com/jquery-3.3.1.slim.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/umd/popper.min.js"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js"></script>
    <script>
        const barangData = {
            "35.5 B 6K": 455000,
            "36 XB 6K": 455000,
            "44 Kuning 8K": 555000,
            "46 Putih 8K": 580000,
            "48 Kuning 8K": 605000,
            "49 Putih 8K": 620000,
            "75 16K": 933000,
            "76 XB 16K": 942000,
            "83 17K": 1029000,
            "84 XB 17K": 1042000,
            "78-79 BG&Amero 16K": 978000,
            "89 LPM&Amero 17K": 1104000,
            "90 SDW": 1116000
        };

        function hitungHarga(button) {
            const form = button.parentElement;
            const kodeInput = form.querySelector('.kode');
            const harga = parseInt(kodeInput.dataset.harga || 0);
            const berat = parseFloat(form.querySelector('.berat').value);
            let hasil = Math.round(harga * berat);

            const hasilSebelumPembulatan = hasil;

            const mod = hasil % 1000;
            if (mod > 0 && mod < 500) {
                hasil = hasil - mod + 500;
            } else if (mod > 500 && mod < 1000) {
                hasil = hasil - mod + 1000;
            }

            const formIndex = Array.from(form.parentElement.children).indexOf(form);
            const existingResults = document.querySelectorAll(`.hasil-item[data-form-index="${formIndex}"]`);
            existingResults.forEach(item => item.remove());

            const hasilDiv = document.getElementById('hasil');
            const hasilItem = document.createElement('div');
            hasilItem.className = 'hasil-item';
            hasilItem.dataset.formIndex = formIndex;
            hasilItem.textContent = `Harga: ${formatRupiah(harga.toString())}, Berat: ${berat}, Total Sebelum Pembulatan: ${formatRupiah(hasilSebelumPembulatan.toString())}, Total Setelah Pembulatan: ${formatRupiah(hasil.toString())}`;
            hasilDiv.appendChild(hasilItem);

            updateTotalHarga();
        }

        function tambahForm() {
            const formsContainer = document.getElementById('forms-container');
            const newForm = document.createElement('div');
            newForm.className = 'form-penjualan';
            newForm.innerHTML = `
                <div class="form-group">
                    <label for="kode">Kode Barang:</label>
                    <input type="text" class="form-control kode" placeholder="Cari barang...">
                    <select class="form-control kode-dropdown mt-2" size="5" style="display: none;"></select>
                </div>
                <div class="form-group">
                    <label for="harga">Harga:</label>
                    <input type="text" class="form-control harga" readonly>
                </div>
                <div class="form-group">
                    <label for="berat">Berat (gr):</label>
                    <input type="number" class="form-control berat">
                </div>
                <button class="btn btn-dark" onclick="hitungHarga(this)">Hitung</button>
            `;
            formsContainer.appendChild(newForm);

            initSearchBox(newForm.querySelector('.kode'));
        }

        function updateTotalHarga() {
            const totalHargaElem = document.getElementById('total-harga');
            const hasilItems = document.querySelectorAll('.hasil-item');
            let total = 0;
            hasilItems.forEach(item => {
                const totalSetelahPembulatan = parseInt(item.textContent.match(/Total Setelah Pembulatan: Rp\. (\d+)/)[1].replace(/\./g, ''));
                total += totalSetelahPembulatan;
            });
            totalHargaElem.textContent = formatRupiah(total.toString());
        }

        function clearAll() {
            document.getElementById('forms-container').innerHTML = `
                <div class="form-penjualan">
                    <div class="form-group">
                        <label for="kode">Kode Barang:</label>
                        <input type="text" class="form-control kode" placeholder="Cari barang...">
                        <select class="form-control kode-dropdown mt-2" size="5" style="display: none;"></select>
                    </div>
                    <div class="form-group">
                        <label for="harga">Harga:</label>
                        <input type="text" class="form-control harga" readonly>
                    </div>
                    <div class="form-group">
                        <label for="berat">Berat (gr):</label>
                        <input type="number" class="form-control berat">
                    </div>
                    <button class="btn btn-dark" onclick="hitungHarga(this)">Hitung</button>
                </div>
            `;
            document.getElementById('hasil').innerHTML = '';
            document.getElementById('total-harga').textContent = '0';

            initSearchBox(document.querySelector('.kode'));
        }

        function formatRupiah(angka, prefix) {
            const numberString = angka.replace(/[^,\d]/g, '').toString();
            const split = numberString.split(',');
            const sisa = split[0].length % 3;
            const rupiah = split[0].substr(0, sisa) + split[0].substr(sisa).match(/\d{3}/g).join('.');
            return prefix === undefined ? rupiah : (rupiah ? 'Rp. ' + rupiah : '');
        }

        function initSearchBox(input) {
            input.addEventListener('input', function () {
                const dropdown = this.nextElementSibling;
                const searchValue = this.value.toLowerCase();
                dropdown.innerHTML = '';
                dropdown.style.display = 'none';

                if (searchValue.length > 0) {
                    const filteredItems = Object.keys(barangData).filter(item => item.toLowerCase().includes(searchValue));
                    if (filteredItems.length > 0) {
                        filteredItems.forEach(item => {
                            const option = document.createElement('option');
                            option.value = item;
                            option.textContent = item;
                            dropdown.appendChild(option);
                        });
                        dropdown.style.display = 'block';
                    }
                }
            });

            input.addEventListener('focus', function () {
                const dropdown = this.nextElementSibling;
                if (dropdown.children.length > 0) {
                    dropdown.style.display = 'block';
                }
            });

            input.addEventListener('blur', function () {
                setTimeout(() => {
                    this.nextElementSibling.style.display = 'none';
                }, 100);
            });

            input.nextElementSibling.addEventListener('change', function () {
                const selectedItem = this.value;
                const hargaInput = this.previousElementSibling.nextElementSibling.nextElementSibling;
                hargaInput.value = formatRupiah(barangData[selectedItem].toString());
                hargaInput.previousElementSibling.dataset.harga = barangData[selectedItem];
            });
        }

        function hitungTotalBeli() {
            const hargaNota = parseInt(document.getElementById('harga-nota').value || 0);
            const hargaPokok = parseInt(document.getElementById('harga-pokok').value || 0);
            const potongan = parseInt(document.getElementById('potongan').value || 0);
            const beratBeli = parseFloat(document.getElementById('berat-beli').value || 0);
            let totalBeli;

            if (hargaNota) {
                totalBeli = hargaNota - (potongan * beratBeli);
            } else {
                totalBeli = (hargaPokok - potongan) * beratBeli;
            }

            document.getElementById('total-beli').textContent = formatRupiah(totalBeli.toString());
        }

        // Inisialisasi form pertama kali
        document.addEventListener('DOMContentLoaded', function () {
            initSearchBox(document.querySelector('.kode'));
        });
    </script>
</body>
</html>
             
